<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Leaderboard.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">headless</a> &gt; <a href="index.source.html" class="el_package">com.mathochiststudios.escapefromuni.entities.Utils</a> &gt; <span class="el_source">Leaderboard.java</span></div><h1>Leaderboard.java</h1><pre class="source lang-java linenums">package com.mathochiststudios.escapefromuni.entities.Utils;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;
/**
 * A simple leaderboard system that reads and writes to a text file.
 * Each entry is stored in the format &quot;name - score-difficulty&quot;.
 * Used for maintaining high scores between game sessions.
 */
<span class="fc" id="L14">public class Leaderboard {</span>

    //does nothing lol
    public void Leaderboard() {
<span class="nc" id="L18">        loadLeaderboard();</span>
<span class="nc" id="L19">    }</span>

    // array of strings representing leaderboard entries where each line is &quot;name - score-difficulty&quot; for easy printing and parsing
<span class="fc" id="L22">    private List&lt;String&gt; leaderboardLines = new ArrayList&lt;&gt;();</span>

    // opens the leaderboard file in the same directory as the exe because tryna do stuff like open program files gets fucky on linux and mac and im not doing that no
<span class="fc" id="L25">    String path = System.getProperty(&quot;user.dir&quot;);</span>
<span class="fc" id="L26">    File leaderboardFile = new File(path, &quot;leaderboards.txt&quot;);</span>

    //used for rendering the leaderboard in leaderboard menu
    public List&lt;String&gt; getLeaderboardLines() {
<span class="fc" id="L30">        return leaderboardLines;</span>
    }

    //does a load of funky stuff to add a new entry to the leaderboard while keeping it sorted since we have to keep the higher scores at the top
    /**
     * adds a new entry to the leaderboard if the score qualifies.
     * @param name The name of the player.
     * @param score The score achieved by the player.
     * @param difficulty The difficulty level of the game as a string (important i fucked this up before).
     */
    public void addLeaderboardEntry(String name, int score, String difficulty) {
        //mainly works by reading each line in the old list, if the new score is higher than the one its checking it puts the new score in then adds the rest of the old ones after
<span class="fc" id="L42">        List&lt;String&gt; newleaderboardLines = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L43">        System.out.println(&quot;trying to add&quot; + name + &quot; - &quot; + score + &quot;-&quot; + difficulty);</span>
<span class="fc" id="L44">        Boolean hasLineBeenAdded = false;</span>
        //try catch to stop it all from imploding if i dare run it on linux which despises giving any program file permissions for me
<span class="fc" id="L46">        try (BufferedReader br = new BufferedReader(new FileReader(leaderboardFile))) {</span>
            String line;

            //reads each line of the old leaderboard
<span class="fc bfc" id="L50" title="All 2 branches covered.">            while ((line = br.readLine()) != null) {</span>
                //if i fucked up this will run i beg it wont but if it does itll just ignore the empty line
<span class="pc bpc" id="L52" title="1 of 2 branches missed.">                if (line.trim().isEmpty()) {</span>
<span class="nc" id="L53">                    continue;</span>
                }
                //splits the line into name and score parts so i can check the score
<span class="fc" id="L56">                String[] parts = line.split(&quot; - &quot;);</span>
<span class="fc" id="L57">                String[] scoreParts = parts[1].split(&quot;-&quot;);</span>
<span class="fc" id="L58">                int lineScore = Integer.parseInt(scoreParts[0]);</span>
                //checks if the score found in this line is bigger or lower than the score just gotten
<span class="pc bpc" id="L60" title="1 of 4 branches missed.">                if (lineScore &lt;= score &amp;&amp; !hasLineBeenAdded) {</span>
<span class="fc" id="L61">                    newleaderboardLines.add(name + &quot; - &quot; + score + &quot;-&quot; + difficulty);</span>
<span class="fc" id="L62">                    hasLineBeenAdded = true;</span>
                }
<span class="fc" id="L64">                newleaderboardLines.add(line);</span>
<span class="fc" id="L65">            }</span>
            //oh btw fun fact it doesnt just stop adding at 10 the txt file can be infinite size but only 10 are displayed
            //pretty much just &quot;if the new score is the lowest score add it to the end&quot;
<span class="fc bfc" id="L68" title="All 2 branches covered.">            if (!hasLineBeenAdded) {</span>
<span class="fc" id="L69">                newleaderboardLines.add(name + &quot; - &quot; + score + &quot;-&quot; + difficulty);</span>
            }
<span class="nc" id="L71">        } catch (IOException e) {</span>
<span class="nc" id="L72">            leaderboardLines.clear();</span>
<span class="nc" id="L73">            leaderboardLines.add(&quot;Error reading leaderboard.&quot;);</span>
<span class="fc" id="L74">        }</span>

        //now we write the file with the newleaderboardLines which contains the up to date leaderboard, apparently you can just put the filewriter second variable to
        //false and it just overwrites each line instead which works brillantly here since the new leaderboard will always be bigger than the old
        try {
<span class="pc bpc" id="L79" title="1 of 2 branches missed.">            if (!leaderboardFile.exists()) {</span>
<span class="nc" id="L80">                leaderboardFile.createNewFile();</span>
            }
<span class="fc" id="L82">            java.io.FileWriter writer = new java.io.FileWriter(leaderboardFile, false);</span>
<span class="fc bfc" id="L83" title="All 2 branches covered.">            for (String line : newleaderboardLines) {</span>
<span class="fc" id="L84">                System.out.println(line);</span>
<span class="fc" id="L85">                writer.write(line + &quot;\n&quot;);</span>
<span class="fc" id="L86">            }</span>
<span class="fc" id="L87">            writer.close();</span>
<span class="nc" id="L88">        } catch (IOException e) {</span>
<span class="nc" id="L89">            e.printStackTrace();</span>
<span class="fc" id="L90">        }</span>

        //fixes the leaderboardlines variable so i can stop running it every single frame dear god how didnt i notice that before
<span class="fc" id="L93">        this.loadLeaderboard();</span>
<span class="fc" id="L94">    }</span>


    //loads from the leaderboard file so the leaderboard is maintained between sessions
    /**
     * loads the leaderboard from the text file into memory.
     */
    public void loadLeaderboard() {
<span class="fc" id="L102">        leaderboardLines.clear();</span>

        try {
<span class="fc" id="L105">            leaderboardFile.createNewFile();</span>
<span class="nc" id="L106">        } catch (IOException e) {</span>
<span class="nc" id="L107">            return;</span>
<span class="fc" id="L108">        }</span>

<span class="pc bpc" id="L110" title="1 of 2 branches missed.">        if (!leaderboardFile.exists()) {</span>
<span class="nc" id="L111">            return;</span>
        }

<span class="fc" id="L114">        try (BufferedReader br = new BufferedReader(new FileReader(leaderboardFile))) {</span>
            String line;
<span class="fc bfc" id="L116" title="All 2 branches covered.">            while ((line = br.readLine()) != null) {</span>
<span class="fc" id="L117">                leaderboardLines.add(line);</span>
<span class="pc bpc" id="L118" title="1 of 2 branches missed.">                if (leaderboardLines.size() &gt;= 20) break;</span>
            }
<span class="nc" id="L120">        } catch (IOException e) {</span>
<span class="nc" id="L121">            leaderboardLines.clear();</span>
<span class="nc" id="L122">            leaderboardLines.add(&quot;Error reading leaderboard.&quot;);</span>
<span class="fc" id="L123">        }</span>
<span class="fc" id="L124">    }</span>

    public void clearLeaderboard() {
<span class="fc" id="L127">        leaderboardLines.clear();</span>
        try {
<span class="pc bpc" id="L129" title="1 of 2 branches missed.">            if (leaderboardFile.exists()) {</span>
<span class="fc" id="L130">                java.io.FileWriter writer = new java.io.FileWriter(leaderboardFile, false);</span>
<span class="fc" id="L131">                writer.write(&quot;&quot;);</span>
<span class="fc" id="L132">                writer.close();</span>
            }
<span class="nc" id="L134">        } catch (IOException e) {</span>
<span class="nc" id="L135">            e.printStackTrace();</span>
<span class="fc" id="L136">        }</span>
<span class="fc" id="L137">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>