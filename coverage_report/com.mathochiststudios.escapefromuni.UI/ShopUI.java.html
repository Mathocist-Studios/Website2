<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ShopUI.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">headless</a> &gt; <a href="index.source.html" class="el_package">com.mathochiststudios.escapefromuni.UI</a> &gt; <span class="el_source">ShopUI.java</span></div><h1>ShopUI.java</h1><pre class="source lang-java linenums">// java
package com.mathochiststudios.escapefromuni.UI;

import com.badlogic.gdx.Gdx;
import com.badlogic.gdx.graphics.Color;
import com.badlogic.gdx.graphics.g2d.BitmapFont;
import com.badlogic.gdx.graphics.g2d.GlyphLayout;
import com.badlogic.gdx.graphics.g2d.Sprite;
import com.badlogic.gdx.graphics.g2d.SpriteBatch;
import com.badlogic.gdx.scenes.scene2d.Actor;
import com.badlogic.gdx.scenes.scene2d.Stage;
import com.badlogic.gdx.scenes.scene2d.ui.Image;
import com.badlogic.gdx.scenes.scene2d.ui.Label;
import com.badlogic.gdx.scenes.scene2d.ui.Table;
import com.badlogic.gdx.scenes.scene2d.utils.SpriteDrawable;
import com.badlogic.gdx.utils.Align;
import com.badlogic.gdx.utils.GdxRuntimeException;
import com.badlogic.gdx.utils.viewport.Viewport;
import com.badlogic.gdx.graphics.glutils.ShapeRenderer;
import com.mathochiststudios.escapefromuni.Game;
import com.mathochiststudios.escapefromuni.ShopStuff.Shop;
import com.mathochiststudios.escapefromuni.Tests.HeadlessShapeRenderer;
import com.mathochiststudios.escapefromuni.Tests.IShapeRenderer;
import com.mathochiststudios.escapefromuni.Tests.LiveShapeRenderer;
import com.mathochiststudios.escapefromuni.entities.Player;

public class ShopUI {

<span class="fc" id="L29">    Mouse mouse = new Mouse();</span>

    private IShapeRenderer shapeRenderer;

    private Stage stage;
    private Table rootTable;
    private Table iconTable;
    private Table contentTable;
    private Image edImage;
    private Image bfImage;
    private Image shopIconImage;

<span class="fc" id="L41">    private double lastClickTime = 0.0;</span>

<span class="fc" id="L43">    public ShopUI() {</span>

        try {
<span class="nc" id="L46">            shapeRenderer = new LiveShapeRenderer();</span>
<span class="fc" id="L47">        } catch (GdxRuntimeException e) {</span>
            // Fallback to headless shape renderer if LiveShapeRenderer cannot be created
<span class="fc" id="L49">            shapeRenderer = new HeadlessShapeRenderer();</span>
<span class="nc" id="L50">        }</span>

<span class="fc" id="L52">    }</span>

    public void drawShopMenu(Viewport viewport, SpriteBatch batch, Sprite shopIconSprite, Sprite buyEDSprite, Sprite buyBFSprite, BitmapFont shopfont, GlyphLayout layout) {
<span class="nc" id="L55">        viewport.apply();</span>
<span class="nc" id="L56">        batch.setProjectionMatrix(viewport.getCamera().combined);</span>

<span class="nc bnc" id="L58" title="All 4 branches missed.">        if (stage == null || stage.getViewport() != viewport) {</span>
<span class="nc bnc" id="L59" title="All 2 branches missed.">            if (stage != null) stage.dispose();</span>
<span class="nc" id="L60">            stage = new Stage(viewport, batch);</span>

            // root table fills the stage; it will contain an iconTable (top-right) and a contentTable (center)
<span class="nc" id="L63">            rootTable = new Table();</span>
<span class="nc" id="L64">            rootTable.setFillParent(true);</span>
<span class="nc" id="L65">            stage.addActor(rootTable);</span>

<span class="nc" id="L67">            iconTable = new Table();</span>
<span class="nc" id="L68">            contentTable = new Table();</span>

<span class="nc" id="L70">            edImage = new Image();</span>
<span class="nc" id="L71">            bfImage = new Image();</span>
<span class="nc" id="L72">            shopIconImage = new Image();</span>
        }

        // world sizes &amp; margins
<span class="nc" id="L76">        float worldW = viewport.getWorldWidth();</span>
<span class="nc" id="L77">        float worldH = viewport.getWorldHeight();</span>
<span class="nc" id="L78">        float marginX = Math.max(10f, worldW * 0.05f);</span>
<span class="nc" id="L79">        float marginY = Math.max(10f, worldH * 0.05f);</span>
<span class="nc" id="L80">        float paddingTop = Math.max(20f, worldH * 0.12f);</span>
<span class="nc" id="L81">        float rowSpacing = Math.max(12f, worldH * 0.06f);</span>

        // background (semi-transparent) in world coords
<span class="nc" id="L84">        shapeRenderer.setProjectionMatrix(viewport.getCamera().combined);</span>
<span class="nc" id="L85">        shapeRenderer.begin(ShapeRenderer.ShapeType.Filled);</span>
<span class="nc" id="L86">        shapeRenderer.setColor(0f, 0f, 0f, 0.8f);</span>
<span class="nc" id="L87">        shapeRenderer.rect(marginX, marginY, worldW - marginX * 2f, worldH - marginY * 2f);</span>
<span class="nc" id="L88">        shapeRenderer.end();</span>

        // create drawables (copies) and size them preserving aspect ratio
<span class="nc" id="L91">        SpriteDrawable edDrawable = new SpriteDrawable(new Sprite(buyEDSprite));</span>
<span class="nc" id="L92">        SpriteDrawable bfDrawable = new SpriteDrawable(new Sprite(buyBFSprite));</span>
<span class="nc" id="L93">        SpriteDrawable iconDrawable = new SpriteDrawable(new Sprite(shopIconSprite));</span>

<span class="nc" id="L95">        float buttonTargetWidth = Math.min(worldW * 0.5f, 600f);</span>
<span class="nc" id="L96">        float edScale = buttonTargetWidth / buyEDSprite.getWidth();</span>
<span class="nc" id="L97">        float bfScale = buttonTargetWidth / buyBFSprite.getWidth();</span>
<span class="nc" id="L98">        edDrawable.getSprite().setSize(buttonTargetWidth, buyEDSprite.getHeight() * edScale);</span>
<span class="nc" id="L99">        bfDrawable.getSprite().setSize(buttonTargetWidth, buyBFSprite.getHeight() * bfScale);</span>

<span class="nc" id="L101">        float iconW = Math.min(worldW * 0.12f, 96f);</span>
<span class="nc" id="L102">        float iconScale = iconW / shopIconSprite.getWidth();</span>
<span class="nc" id="L103">        iconDrawable.getSprite().setSize(iconW, shopIconSprite.getHeight() * iconScale);</span>

<span class="nc" id="L105">        edImage.setDrawable(edDrawable);</span>
<span class="nc" id="L106">        edImage.setSize(edDrawable.getSprite().getWidth(), edDrawable.getSprite().getHeight());</span>
<span class="nc" id="L107">        bfImage.setDrawable(bfDrawable);</span>
<span class="nc" id="L108">        bfImage.setSize(bfDrawable.getSprite().getWidth(), bfDrawable.getSprite().getHeight());</span>
<span class="nc" id="L109">        shopIconImage.setDrawable(iconDrawable);</span>
<span class="nc" id="L110">        shopIconImage.setSize(iconDrawable.getSprite().getWidth(), iconDrawable.getSprite().getHeight());</span>

        // label style
<span class="nc" id="L113">        Label.LabelStyle ls = new Label.LabelStyle(shopfont, Color.WHITE);</span>

        // rebuild root/icon/content tables each frame so layout follows viewport
<span class="nc" id="L116">        rootTable.clear();</span>
<span class="nc" id="L117">        iconTable.clear();</span>
<span class="nc" id="L118">        contentTable.clear();</span>

        // build iconTable: top-right only, does not affect contentTable
<span class="nc" id="L121">        iconTable.top().right();</span>
<span class="nc" id="L122">        iconTable.add(shopIconImage).padTop(marginY).padRight(marginX);</span>
<span class="nc" id="L123">        iconTable.row();</span>
<span class="nc" id="L124">        Label exitLabel = new Label(&quot;Press E to exit shop&quot;, ls);</span>
<span class="nc" id="L125">        exitLabel.setAlignment(Align.right);</span>
<span class="nc" id="L126">        iconTable.add(exitLabel).padTop(rowSpacing * 0.2f).padRight(marginX);</span>

        // build contentTable: centered with spacing
<span class="nc" id="L129">        contentTable.center().padTop(paddingTop);</span>
<span class="nc" id="L130">        Label edTitle = new Label(&quot;Energy Drink&quot;, ls);</span>
<span class="nc" id="L131">        edTitle.setAlignment(Align.center);</span>
<span class="nc" id="L132">        Label edPrice = new Label(&quot;Price: 2 coins&quot;, ls);</span>
<span class="nc" id="L133">        edPrice.setAlignment(Align.center);</span>

<span class="nc" id="L135">        contentTable.add(edTitle).center().row();</span>
<span class="nc" id="L136">        contentTable.add(edImage).center().padTop(rowSpacing * 0.2f).row();</span>
<span class="nc" id="L137">        contentTable.add(edPrice).center().padTop(rowSpacing * 0.2f).row();</span>
<span class="nc" id="L138">        contentTable.add().height(rowSpacing * 1.2f).row();</span>

<span class="nc" id="L140">        Label bfTitle = new Label(&quot;Bird Feed&quot;, ls);</span>
<span class="nc" id="L141">        bfTitle.setAlignment(Align.center);</span>
<span class="nc" id="L142">        Label bfPrice = new Label(&quot;Price: 5 coins&quot;, ls);</span>
<span class="nc" id="L143">        bfPrice.setAlignment(Align.center);</span>

<span class="nc" id="L145">        contentTable.add(bfTitle).center().row();</span>
<span class="nc" id="L146">        contentTable.add(bfImage).center().padTop(rowSpacing * 0.2f).row();</span>
<span class="nc" id="L147">        contentTable.add(bfPrice).center().row();</span>

        // assemble rootTable: icon row (only affects top area) then content fills center
<span class="nc" id="L150">        rootTable.top();</span>
<span class="nc" id="L151">        rootTable.add(iconTable).expandX().fillX();</span>
<span class="nc" id="L152">        rootTable.add(contentTable).expand().center();</span>

<span class="nc" id="L154">        stage.act(Gdx.graphics.getDeltaTime());</span>
<span class="nc" id="L155">        stage.draw();</span>
<span class="nc" id="L156">    }</span>

    public void inputShopMenu(Game game, Viewport viewport, Player player) {
<span class="nc bnc" id="L159" title="All 2 branches missed.">        if (stage == null) return;</span>
<span class="nc bnc" id="L160" title="All 2 branches missed.">        if (Gdx.input.isTouched()) {</span>
<span class="nc" id="L161">            mouse.update(viewport);</span>

<span class="nc bnc" id="L163" title="All 2 branches missed.">            if (System.currentTimeMillis() - lastClickTime &lt; 250) {</span>
<span class="nc" id="L164">                return; // ignore clicks within 250ms of last click</span>
            }

<span class="nc" id="L167">            lastClickTime = System.currentTimeMillis();</span>

<span class="nc" id="L169">            Actor hit = stage.hit(mouse.getX(), mouse.getY(), true);</span>
<span class="nc bnc" id="L170" title="All 6 branches missed.">            while (hit != null &amp;&amp; hit != edImage &amp;&amp; hit != bfImage) {</span>
<span class="nc" id="L171">                hit = hit.getParent();</span>
            }
<span class="nc bnc" id="L173" title="All 2 branches missed.">            if (hit == edImage) {</span>
<span class="nc" id="L174">                Shop.buyItem(game, player, Shop.energyDrink);</span>
<span class="nc bnc" id="L175" title="All 2 branches missed.">            } else if (hit == bfImage) {</span>
<span class="nc" id="L176">                Shop.buyItem(game, player, Shop.birdFeed);</span>
            }

        }
<span class="nc" id="L180">    }</span>

    public void dispose() {
<span class="nc" id="L183">        shapeRenderer.dispose();</span>
<span class="nc bnc" id="L184" title="All 2 branches missed.">        if (stage != null) stage.dispose();</span>
<span class="nc" id="L185">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>